#!/bin/bash

# Extract the directory where the Pom file is
pom_directory=$(dirname "$(locate pom.xml | xargs grep -l "<struts2.version>" | head -n 1)")

if [ -z "$pom_directory" ]; then
    echo "The directory of the pom.xml file with the Struts version was not found."
    exit 1
fi

# Struts version updated in pom.xml file
sed -i 's/<struts2.version>.*<\/struts2.version>/<struts2.version>6.3.0.2<\/struts2.version>/' "$pom_directory/pom.xml"

cd "$pom_directory" || exit 1

# I build again the mvn module that contains struts
mvn -e clean package -Dmaven.test.skip=true -pl file-upload

echo "The Apache Struts version has been updated and the module was rebuilt correctly."