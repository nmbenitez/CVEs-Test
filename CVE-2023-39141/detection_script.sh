#!/bin/bash

# Este script tiene la finalidad de detectar la vulnerabilidad CVE-2023-39141
detect_vulnerability() {

    read -p "Ingrese la ruta de instalación del servidor WebUI-Aria2 (ruta completa al directorio donde se encuentra node-server.js): " webui_path

    if [ -f "$webui_path/node-server.js" ]; then

        if grep -q "filename = path.join(process.cwd(), \"docs\", uri);" "$webui_path/node-server.js"; then

            if grep -q "filename.indexOf(cwdir)" "$webui_path/node-server.js"; then
                echo "La vulnerabilidad CVE-2023-39141 ha sido mitigada en $webui_path/node-server.js"
            else
                echo "La vulnerabilidad CVE-2023-39141 ha sido detectada en $webui_path/node-server.js"

                read -p "¿Desea mitigar la vulnerabilidad? (s/n): " response
                if [ "$response" = "s" ]; then
                    python3 mit-script.py
                fi
            fi
        else
            echo "No se encontraron indicios de la vulnerabilidad CVE-2023-39141 en $webui_path/node-server.js"
        fi
    else
        echo "El archivo node-server.js no fue encontrado en la ruta proporcionada: $webui_path"
    fi
}

detect_vulnerability