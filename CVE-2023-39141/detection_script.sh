#!/bin/bash

# This script is intended to detect the vulnerability CVE-2023-39141
detect_vulnerability() {

    read -p "Enter the WebUI-Aria2 server installation path (full path to the directory where node-server.js is located): " webui_path

    if [ -f "$webui_path/node-server.js" ]; then

        if grep -q "filename = path.join(process.cwd(), \"docs\", uri);" "$webui_path/node-server.js"; then

            if grep -q "filename.indexOf(cwdir)" "$webui_path/node-server.js"; then
                echo "Vulnerability CVE-2023-39141 has been mitigated in $webui_path/node-server.js"
            else
                echo "Vulnerability CVE-2023-39141 detected in $webui_path/node-server.js"

                read -p "Do you wish to mitigate vulnerability (y/n):" response
                if [ "$response" = "s" ]; then
                    python3 mit-script.py
                fi
            fi
        else
            echo "No evidence found for vulnerability CVE-2023-39141 in $webui_path/node-server.js"
        fi
    else
        echo "The file node-server.js was not found in the provided path: $webui_path."
    fi
}

detect_vulnerability