#!/usr/bin/env python3

# Path to node-server.js file
node_server_path = "/home/kali/webui-aria2/node-server.js"

# Path Traversal Prevention
path_traversal_prev = '''
// Path Traversal Prevention
var cwdir = path.join(process.cwd(), "docs");
if (filename.indexOf(cwdir) !== 0) {
    response.writeHead(400, { "Content-Type": "text/plain" });
    response.write("Invalid characters in the file name\\n");
    response.end();
    return;
}
// End Fix Path Traversal Prevention
'''

with open(node_server_path, 'r') as file:
    content = file.readlines()

# Search for the position to insert the Path Traversal Prevention code
match = 'path.join(process.cwd()'
for i, line in enumerate(content):
    if match in line:
        insert_index = i + 1
        break
else:
    raise ValueError(f"Match string not found: {match}")

content.insert(insert_index, path_traversal_prev)

# Write the modified content in the file
with open(node_server_path, 'w') as file:
    file.writelines(content)

print(f"Added prevention to Path Traversal in {node_server_path}.")
